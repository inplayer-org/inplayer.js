"use strict";function _interopDefault(t){return t&&"object"==typeof t&&"default"in t?t.default:t}function __async(t){return new Promise(function(e,n){function o(i,s){try{var c=t[s?"throw":"next"](i)}catch(t){return void n(t)}c.done?e(c.value):Promise.resolve(c.value).then(o,r)}function r(t){o(t,1)}o()})}function createCommonjsModule(t,e){return e={exports:{}},t(e,e.exports),e.exports}var Cookies=require("js-cookie"),net=_interopDefault(require("net")),websocket=_interopDefault(require("websocket")),config={BASE_URL:"https://staging-v2.inplayer.com",INPLAYER_TOKEN_NAME:"inplayer_token",stomp:{url:"wss://staging-v2.inplayer.com:15671/ws",login:"notifications",password:"notifications"}},API={signIn:config.BASE_URL+"/accounts/login",signOut:config.BASE_URL+"/accounts/logout",signUp:config.BASE_URL+"/accounts",requestNewPassword:config.BASE_URL+"/accounts/forgot-password",setNewPassword:function(t){return config.BASE_URL+"/accounts/forgot-password/"+t},getAccountInfo:config.BASE_URL+"/accounts",social:function(t){return config.BASE_URL+"/accounts/social?state="+t},updateAccount:config.BASE_URL+"/accounts",changePassword:config.BASE_URL+"/accounts/change-password",getRegisterFields:function(t){return config.BASE_URL+"/accounts/register-fields/"+t},checkAccess:function(t,e){return void 0===e&&(e=!1),e?config.BASE_URL+"/item/access?"+t:config.BASE_URL+"/items/"+t+"/access"},findAsset:function(t,e){return config.BASE_URL+"/items/"+e+"/"+t},findExternalAsset:function(t,e){return config.BASE_URL+"/items/assets/external/"+t+"/"+e},findPackage:function(t){return config.BASE_URL+"/items/packages/"+t},findAccessFees:function(t){return config.BASE_URL+"/items/"+t+"/access-fees"},freemium:config.BASE_URL+"/items/access/unlimited",getPaymentMethods:config.BASE_URL+"/payments/methods",getPaymentTools:function(t){return config.BASE_URL+"/payments/method/"+t+"/tools"},payForAsset:config.BASE_URL+"/payments",externalPayments:config.BASE_URL+"/external-payments",getSubscriptions:config.BASE_URL+"/subscriptions",subscribe:config.BASE_URL+"/subscriptions",getDlcLinks:function(t){return config.BASE_URL+"/dlc/"+t+"/links"},getDiscount:config.BASE_URL+"/vouchers/discount",getBranding:function(t){return config.BASE_URL+"/branding/paywall/"+t},downloadFile:function(t,e){return config.BASE_URL+"/dlc/"+t+"/"+e}},User=function(){};User.prototype.signIn=function(t){return __async(function*(){var e=new FormData;e.append("email",t.email),e.append("password",t.password),e.append("merchant_uuid",t.merchant_uuid),e.append("referrer",t.referrer);try{var n=yield(yield fetch(API.signIn,{method:"POST",body:e})).json();return n.access_token&&Cookies.set(config.INPLAYER_TOKEN_NAME,n.access_token),n}catch(t){return!1}}())},User.prototype.signOut=function(){return __async(function*(){var t=Cookies.get(config.INPLAYER_TOKEN_NAME);try{return(yield(yield fetch(API.signOut,{headers:{Authorization:"Bearer "+t}})).json()).explain&&Cookies.remove(config.INPLAYER_TOKEN_NAME),!0}catch(t){return!1}}())},User.prototype.signUp=function(t){return __async(function*(){var e=new FormData;e.append("full_name",t.full_name),e.append("email",t.email),e.append("password",t.password),e.append("password_confirmation",t.password_confirmation),e.append("merchant_uuid",t.merchant_uuid),e.append("type",t.type),e.append("referrer",t.referrer);try{return yield(yield fetch(API.signUp,{method:"POST",body:e})).json()}catch(t){return!1}}())},User.prototype.isSignedIn=function(){return void 0!==Cookies.get(config.INPLAYER_TOKEN_NAME)},User.prototype.token=function(){return Cookies.get(config.INPLAYER_TOKEN_NAME)},User.prototype.setTokenInCookie=function(t){Cookies.set(config.INPLAYER_TOKEN_NAME,t)},User.prototype.requestNewPassword=function(t){return __async(function*(){var e=new FormData;e.append("email",t.email),e.append("merchant_uuid",t.merchant_uuid);try{return yield(yield fetch(API.requestNewPassword,{method:"POST",body:e})).json()}catch(t){return!1}}())},User.prototype.setNewPassword=function(t,e){return __async(function*(){var n="password="+t.password+"&password_confirmation="+t.password_confirmation;try{return yield(yield fetch(API.setNewPassword(e),{method:"PUT",body:n,headers:{"Content-Type":"x-www-form-urlencoded"}})).json()}catch(t){return!1}}())},User.prototype.getAccountInfo=function(t){return __async(function*(){try{var e=yield(yield fetch(API.getAccountInfo,{method:"GET",headers:{Authorization:"Bearer "+t}})).json();if(e)return e}catch(t){return!1}}())},User.prototype.getSocialLoginUrls=function(t){return __async(function*(){try{var e=yield(yield fetch(API.social(t),{method:"GET"})).json();if(e)return e}catch(t){return!1}}())},User.prototype.updateAccount=function(t,e){return __async(function*(){try{var t=yield(yield fetch(API.updateAccount,{method:"PUT",body:t,headers:{Authorization:"Bearer "+e,"Content-Type":"x-www-form-urlencoded"}})).json();return t}catch(t){return!1}}())},User.prototype.changePassword=function(t,e){return __async(function*(){try{var t=yield(yield fetch(API.changePassword,{method:"POST",body:t,headers:{Authorization:"Bearer "+e}})).json();return t}catch(t){return!1}}())},User.prototype.getRegisterFields=function(t){return __async(function*(){try{return yield(yield fetch(API.getRegisterFields(t))).json()}catch(t){return!1}}())};var Asset=function(){};Asset.prototype.checkAccessForAsset=function(t,e){return __async(function*(){try{return yield(yield fetch(API.checkAccess(e),{headers:{Authorization:"Bearer "+t}})).json()}catch(t){return!1}}())},Asset.prototype.checkAccessForMultipleAssets=function(t,e){return __async(function*(){try{return yield(yield fetch(API.checkAccess(e,!0),{headers:{Authorization:"Bearer "+t}})).json()}catch(t){return!1}}())},Asset.prototype.findAsset=function(t,e){return __async(function*(){try{return yield(yield fetch(API.findAsset(t,e),{method:"GET"})).json()}catch(t){return!1}}())},Asset.prototype.findExternalAsset=function(t,e){return __async(function*(){try{return yield(yield fetch(API.findExternalAsset(t,e),{method:"GET"})).json()}catch(t){return!1}}())},Asset.prototype.findPackage=function(t){return __async(function*(){try{return yield(yield fetch(API.findPackage(t),{method:"GET"})).json()}catch(t){return!1}}())},Asset.prototype.getAssetAccessFees=function(t){return __async(function*(){try{return yield(yield fetch(API.findAccessFees(t),{method:"GET"})).json()}catch(t){return!1}}())},Asset.prototype.freemiumAsset=function(t,e){return __async(function*(){try{var e=yield(yield fetch(API.freemium,{method:"POST",headers:{Authorization:"Bearer "+t},body:e})).json();return e}catch(t){return!1}}())};var Payment=function(){};Payment.prototype.getPaymentMethods=function(t){return __async(function*(){try{return yield(yield fetch(API.getPaymentMethods,{headers:{Authorization:"Bearer "+t}})).json()}catch(t){return!1}}())},Payment.prototype.getPaymentTools=function(t,e){return __async(function*(){try{return yield(yield fetch(API.getPaymentTools(e),{headers:{Authorization:"Bearer "+t}})).json()}catch(t){return!1}}())},Payment.prototype.payForAsset=function(t,e){return __async(function*(){try{var e=yield(yield fetch(API.payForAsset,{method:"POST",headers:{Authorization:"Bearer "+t},body:e})).json();return e}catch(t){return!1}}())},Payment.prototype.getPayPalParams=function(t,e){return __async(function*(){try{var e=yield(yield fetch(API.externalPayments,{method:"POST",headers:{Authorization:"Bearer "+t},body:e})).json();return e}catch(t){return!1}}())};var Misc=function(){};Misc.prototype.getDlcLinks=function(t,e){return __async(function*(){try{return yield(yield fetch(API.getDlcLinks(e),{headers:{Authorization:"Bearer "+t}})).json()}catch(t){return!1}}())},Misc.prototype.getDiscount=function(t,e){return __async(function*(){try{var e=yield(yield fetch(API.getDiscount,{method:"POST",headers:{Authorization:"Bearer "+t},body:e})).json();return e}catch(t){return!1}}())},Misc.prototype.getBranding=function(t){return __async(function*(){try{return yield(yield fetch(API.getBranding(t),{method:"GET"})).json()}catch(t){return!1}}())},Misc.prototype.downloadProtectedFile=function(t,e,n){return __async(function*(){try{return yield(yield fetch(API.downloadFile(e,n),{headers:{Authorization:"Bearer "+t}})).json()}catch(t){return!1}}())},Misc.prototype.fetchWPContent=function(t){return __async(function*(){try{return yield(yield fetch(t,{credentials:"same-origin"})).json()}catch(t){return!1}}())};var commonjsGlobal="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},stomp=createCommonjsModule(function(t,e){(function(){var t,n,o,r,i={}.hasOwnProperty,s=[].slice;t={LF:"\n",NULL:"\0"},o=function(){function e(t,e,n){this.command=t,this.headers=null!=e?e:{},this.body=null!=n?n:""}var n;return e.prototype.toString=function(){var n,o,r,s,c;n=[this.command],(r=!1===this.headers["content-length"])&&delete this.headers["content-length"],c=this.headers;for(o in c)i.call(c,o)&&(s=c[o],n.push(o+":"+s));return this.body&&!r&&n.push("content-length:"+e.sizeOfUTF8(this.body)),n.push(t.LF+this.body),n.join(t.LF)},e.sizeOfUTF8=function(t){return t?encodeURI(t).match(/%..|./g).length:0},n=function(n){var o,r,i,s,c,u,a,f,d,p,l,h,y,g,m,b,_;for(s=n.search(RegExp(""+t.LF+t.LF)),i=(c=n.substring(0,s).split(t.LF)).shift(),u={},h=function(t){return t.replace(/^\s+|\s+$/g,"")},y=0,m=(b=c.reverse()).length;y<m;y++)f=(p=b[y]).indexOf(":"),u[h(p.substring(0,f))]=h(p.substring(f+1));if(o="",l=s+2,u["content-length"])d=parseInt(u["content-length"]),o=(""+n).substring(l,l+d);else for(r=null,a=g=l,_=n.length;(l<=_?g<_:g>_)&&(r=n.charAt(a))!==t.NULL;a=l<=_?++g:--g)o+=r;return new e(i,u,o)},e.unmarshall=function(e){var o;return function(){var r,i,s,c;for(c=[],r=0,i=(s=e.split(RegExp(""+t.NULL+t.LF+"*"))).length;r<i;r++)(null!=(o=s[r])?o.length:void 0)>0&&c.push(n(o));return c}()},e.marshall=function(n,o,r){return new e(n,o,r).toString()+t.NULL},e}(),n=function(){function e(t){this.ws=t,this.ws.binaryType="arraybuffer",this.counter=0,this.connected=!1,this.heartbeat={outgoing:1e4,incoming:1e4},this.maxWebSocketFrameSize=16384,this.subscriptions={}}var n;return e.prototype.debug=function(t){var e;return"undefined"!=typeof window&&null!==window&&null!=(e=window.console)?e.log(t):void 0},n=function(){return Date.now?Date.now():(new Date).valueOf},e.prototype._transmit=function(t,e,n){var r,i=this;for(r=o.marshall(t,e,n),"function"==typeof this.debug&&this.debug(">>> "+r);;){if(!(r.length>i.maxWebSocketFrameSize))return i.ws.send(r);i.ws.send(r.substring(0,i.maxWebSocketFrameSize)),r=r.substring(i.maxWebSocketFrameSize),"function"==typeof i.debug&&i.debug("remaining = "+r.length)}},e.prototype._setupHeartbeat=function(e){var o,i,s,c,u,a;if((u=e.version)===r.VERSIONS.V1_1||u===r.VERSIONS.V1_2)return a=function(){var t,n,o,r;for(r=[],t=0,n=(o=e["heart-beat"].split(",")).length;t<n;t++)c=o[t],r.push(parseInt(c));return r}(),i=a[0],o=a[1],0!==this.heartbeat.outgoing&&0!==o&&(s=Math.max(this.heartbeat.outgoing,o),"function"==typeof this.debug&&this.debug("send PING every "+s+"ms"),this.pinger=r.setInterval(s,function(e){return function(){return e.ws.send(t.LF),"function"==typeof e.debug?e.debug(">>> PING"):void 0}}(this))),0!==this.heartbeat.incoming&&0!==i?(s=Math.max(this.heartbeat.incoming,i),"function"==typeof this.debug&&this.debug("check PONG every "+s+"ms"),this.ponger=r.setInterval(s,function(t){return function(){var e;if((e=n()-t.serverActivity)>2*s)return"function"==typeof t.debug&&t.debug("did not receive server activity for the last "+e+"ms"),t.ws.close()}}(this))):void 0},e.prototype._parseConnect=function(){var t,e,n,o;switch(t=1<=arguments.length?s.call(arguments,0):[],o={},t.length){case 2:o=t[0],e=t[1];break;case 3:t[1]instanceof Function?(o=t[0],e=t[1],n=t[2]):(o.login=t[0],o.passcode=t[1],e=t[2]);break;case 4:o.login=t[0],o.passcode=t[1],e=t[2],n=t[3];break;default:o.login=t[0],o.passcode=t[1],e=t[2],n=t[3],o.host=t[4]}return[o,e,n]},e.prototype.connect=function(){var e,i,c,u;return e=1<=arguments.length?s.call(arguments,0):[],u=this._parseConnect.apply(this,e),c=u[0],this.connectCallback=u[1],i=u[2],"function"==typeof this.debug&&this.debug("Opening Web Socket..."),this.ws.onmessage=function(e){return function(r){var s,c,u,a,f,d,p,l,h,y,g,m;if(a="undefined"!=typeof ArrayBuffer&&r.data instanceof ArrayBuffer?(s=new Uint8Array(r.data),"function"==typeof e.debug&&e.debug("--- got data length: "+s.length),function(){var t,e,n;for(n=[],t=0,e=s.length;t<e;t++)c=s[t],n.push(String.fromCharCode(c));return n}().join("")):r.data,e.serverActivity=n(),a!==t.LF){for("function"==typeof e.debug&&e.debug("<<< "+a),m=[],h=0,y=(g=o.unmarshall(a)).length;h<y;h++)switch((f=g[h]).command){case"CONNECTED":"function"==typeof e.debug&&e.debug("connected to server "+f.headers.server),e.connected=!0,e._setupHeartbeat(f.headers),m.push("function"==typeof e.connectCallback?e.connectCallback(f):void 0);break;case"MESSAGE":l=f.headers.subscription,(p=e.subscriptions[l]||e.onreceive)?(u=e,d=f.headers["message-id"],f.ack=function(t){return null==t&&(t={}),u.ack(d,l,t)},f.nack=function(t){return null==t&&(t={}),u.nack(d,l,t)},m.push(p(f))):m.push("function"==typeof e.debug?e.debug("Unhandled received MESSAGE: "+f):void 0);break;case"RECEIPT":m.push("function"==typeof e.onreceipt?e.onreceipt(f):void 0);break;case"ERROR":m.push("function"==typeof i?i(f):void 0);break;default:m.push("function"==typeof e.debug?e.debug("Unhandled frame: "+f):void 0)}return m}"function"==typeof e.debug&&e.debug("<<< PONG")}}(this),this.ws.onclose=function(t){return function(){var e;return e="Whoops! Lost connection to "+t.ws.url,"function"==typeof t.debug&&t.debug(e),t._cleanUp(),"function"==typeof i?i(e):void 0}}(this),this.ws.onopen=function(t){return function(){return"function"==typeof t.debug&&t.debug("Web Socket Opened..."),c["accept-version"]=r.VERSIONS.supportedVersions(),c["heart-beat"]=[t.heartbeat.outgoing,t.heartbeat.incoming].join(","),t._transmit("CONNECT",c)}}(this)},e.prototype.disconnect=function(t,e){return null==e&&(e={}),this._transmit("DISCONNECT",e),this.ws.onclose=null,this.ws.close(),this._cleanUp(),"function"==typeof t?t():void 0},e.prototype._cleanUp=function(){if(this.connected=!1,this.pinger&&r.clearInterval(this.pinger),this.ponger)return r.clearInterval(this.ponger)},e.prototype.send=function(t,e,n){return null==e&&(e={}),null==n&&(n=""),e.destination=t,this._transmit("SEND",e,n)},e.prototype.subscribe=function(t,e,n){var o;return null==n&&(n={}),n.id||(n.id="sub-"+this.counter++),n.destination=t,this.subscriptions[n.id]=e,this._transmit("SUBSCRIBE",n),o=this,{id:n.id,unsubscribe:function(){return o.unsubscribe(n.id)}}},e.prototype.unsubscribe=function(t){return delete this.subscriptions[t],this._transmit("UNSUBSCRIBE",{id:t})},e.prototype.begin=function(t){var e,n;return n=t||"tx-"+this.counter++,this._transmit("BEGIN",{transaction:n}),e=this,{id:n,commit:function(){return e.commit(n)},abort:function(){return e.abort(n)}}},e.prototype.commit=function(t){return this._transmit("COMMIT",{transaction:t})},e.prototype.abort=function(t){return this._transmit("ABORT",{transaction:t})},e.prototype.ack=function(t,e,n){return null==n&&(n={}),n["message-id"]=t,n.subscription=e,this._transmit("ACK",n)},e.prototype.nack=function(t,e,n){return null==n&&(n={}),n["message-id"]=t,n.subscription=e,this._transmit("NACK",n)},e}(),r={VERSIONS:{V1_0:"1.0",V1_1:"1.1",V1_2:"1.2",supportedVersions:function(){return"1.1,1.0"}},client:function(t,e){var o,i;return null==e&&(e=["v10.stomp","v11.stomp"]),o=r.WebSocketClass||WebSocket,i=new o(t,e),new n(i)},over:function(t){return new n(t)},Frame:o},null!==e&&(e.Stomp=r),"undefined"!=typeof window&&null!==window?(r.setInterval=function(t,e){return window.setInterval(e,t)},r.clearInterval=function(t){return window.clearInterval(t)},window.Stomp=r):e||(self.Stomp=r)}).call(commonjsGlobal)}),stomp_1=stomp.Stomp,stompNode=createCommonjsModule(function(t,e){(function(){var t,n,o,r,i,s;n=net,(t=stomp).Stomp.setInterval=function(t,e){return setInterval(e,t)},t.Stomp.clearInterval=function(t){return clearInterval(t)},i=function(t,e){var o,r;return o=null,r={url:"tcp:// "+e+":"+t,send:function(t){return o.write(t)},close:function(){return o.end()}},(o=n.connect(t,e,function(t){return r.onopen()})).on("error",function(t){return"function"==typeof r.onclose?r.onclose(t):void 0}),o.on("close",function(t){return"function"==typeof r.onclose?r.onclose(t):void 0}),o.on("data",function(t){var e;return e={data:t.toString()},r.onmessage(e)}),r},s=function(t){var e,n,o,r;return e=websocket.client,n=null,r={url:t,send:function(t){return n.sendUTF(t)},close:function(){return n.close()}},(o=new e).on("connect",function(t){return n=t,r.onopen(),n.on("error",function(t){return"function"==typeof r.onclose?r.onclose(t):void 0}),n.on("close",function(){return"function"==typeof r.onclose?r.onclose():void 0}),n.on("message",function(t){var e;if("utf8"===t.type)return e={data:t.utf8Data},r.onmessage(e)})}),o.connect(t),r},o=function(e,n){var o;return o=i(n,e),t.Stomp.over(o)},r=function(e){var n;return n=s(e),t.Stomp.over(n)},e.overTCP=o,e.overWS=r}).call(commonjsGlobal)}),stompNode_1=stompNode.overTCP,stompNode_2=stompNode.overWS,stompjs=stomp.Stomp,overTCP=stompNode.overTCP,overWS=stompNode.overWS;stompjs.overTCP=overTCP,stompjs.overWS=overWS;var Socket=function(){this.subscription=null};Socket.prototype.subscribe=function(t,e){if(!t&&""!==t)return!1;if(e&&e.onmessage){if("function"!=typeof e.onmessage)return!1}else e.onMessage=function(t){return console.log("Received message:",t)};if(e&&e.onopen&&"function"!=typeof e.onopen)return!1;var n=new("MozWebSocket"in window?MozWebSocket:WebSocket)(config.stomp.url);this.client=stompjs.over(n),this.client.heartbeat.outgoing=2e4,this.client.heartbeat.incoming=2e4,this.client.debug=null;var o=this,r=t;this.client.connect({login:config.stomp.login,passcode:config.stomp.password,"client-id":t},function(){e&&e.onopen&&e.onopen(),o.client.subscribe("/exchange/notifications/"+r,e.onmessage,{id:t,ack:"client"})},function(t){"string"!=typeof t&&console.warn("Stomp error: ",t)}),this.setClient(this.client)},Socket.prototype.setClient=function(t){this.subscription=t},Socket.prototype.unsubscribe=function(){this.subscription&&this.subscription.connected&&this.subscription.unsubscribe()};var InPlayer=function(){this.User=new User,this.Asset=new Asset,this.Payment=new Payment,this.Subscription=new Subscriptions,this.Misc=new Misc,this.Socket=new Socket};InPlayer.prototype.subscribe=function(t,e){return!!this.User.isSignedIn()&&(this.Socket.subscribe(t,e),!0)},InPlayer.prototype.unsubscribe=function(){this.Socket.unsubscribe()};var index=new InPlayer;module.exports=index;
//# sourceMappingURL=inplayer.cjs.js.map
